<div class="row g-4 mt-2">
    <!-- Panel de Registro -->
    <div class="col-lg-4">
        <div class="card border-0 shadow-lg h-100" style="border-radius: 25px; background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(15px);">
            <div class="card-body p-4">
                <h5 class="section-title-premium d-flex align-items-center">
                    <i class="fa fa-plus-circle"></i> REGISTRAR NUEVA TASA
                </h5>

                <form [formGroup]="formTasa" (ngSubmit)="confirmarGuardar(modalConfirmarGuardar)">
                    <div class="modern-form-group">
                        <label>FECHA DE VIGENCIA</label>
                        <app-pastel-datepicker formControlName="fecha"></app-pastel-datepicker>
                    </div>

                    <div class="modern-form-group">
                        <label>VALOR DE LA TASA (Bs./USD)</label>
                        <div class="input-group custom-input-group shadow-none">
                            <span class="input-group-text"><i class="fa fa-money-bill-wave"></i></span>
                            <input type="number" step="0.01" formControlName="monto" class="form-control" placeholder="0.00">
                        </div>
                        <div *ngIf="formTasa.get('monto')?.invalid && formTasa.get('monto')?.touched" class="text-danger small mt-2 fw-bold ps-1">
                            <i class="fa fa-exclamation-circle me-1"></i> Ingrese un monto válido mayor a 0
                        </div>
                    </div>

                    <div class="d-grid pt-3">
                        <button type="submit" [disabled]="formTasa.invalid" class="btn btn-pastel-green py-3 shadow-premium rounded-15 mb-2">
                            <i class="fa fa-save me-2"></i> GUARDAR REGISTRO
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Panel de Historial -->
    <div class="col-lg-8">
        <div class="card border-0 shadow-lg" style="border-radius: 25px;">
            <div class="card-body p-4">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h5 class="section-title-premium mb-0">
                        <i class="fa fa-history"></i> HISTORIAL DE REGISTROS
                    </h5>
                    <div class="badge bg-light rounded-pill px-4 py-2 border small font-weight-bold" style="color: #598c89; border-color: rgba(89, 140, 137, 0.2) !important; letter-spacing: 0.5px;">
                        {{historial.length}} REGISTROS
                    </div>
                </div>

                <div class="table-responsive" style="border-radius: 15px;">
                    <table class="table table-hover align-middle mb-0 custom-table">
                        <thead class="bg-light">
                            <tr>
                                <th class="ps-4">FECHA VIGENCIA</th>
                                <th class="text-center">VALOR TASA</th>
                                <th>RESPONSABLE</th>
                                <th class="text-center">ESTADO</th>
                                <th class="pe-4 text-end">ACCIONES</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let item of historial; let i = index" class="fade-in-down">
                                <td class="ps-4 fw-bold text-dark" style="font-size: 0.95rem;">
                                    <i class="far fa-calendar-check text-muted me-2" style="font-size: 0.9rem;"></i>
                                    {{item.fecha | date:'dd / MM / yyyy'}}
                                </td>
                                <td class="text-center">
                                    <span class="fw-bold fs-5 text-verde-titulos" style="letter-spacing: -0.5px;">{{item.monto | number:'1.2-2'}}</span>
                                    <small class="text-muted ms-1 fw-bold">Bs.</small>
                                </td>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <div class="avatar-mini bg-light me-2 text-center" style="width: 28px; height: 28px; border-radius: 8px; line-height: 28px; background-color: rgba(89, 140, 137, 0.08) !important;">
                                            <i class="fa fa-user" style="font-size: 0.75rem; color: #598c89;"></i>
                                        </div>
                                        <span class="text-muted small fw-bold">{{item.usuario}}</span>
                                    </div>
                                </td>
                                <td class="text-center">
                                    <span [class]="item.estado === 'Activo' ? 'badge-active' : 'badge-inactive'">
                                        {{item.estado}}
                                    </span>
                                </td>
                                <td class="pe-4 text-end">
                                    <button class="btn btn-icon-light me-2" title="Detalles"><i class="fa fa-search"></i></button>
                                    <button class="btn btn-icon-light text-danger" title="Eliminar" (click)="confirmarEliminar(modalConfirmarEliminar, i)"><i class="fa fa-trash-alt"></i></button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Empty state if no records -->
                <div *ngIf="historial.length === 0" class="text-center py-5">
                    <div class="icon-circle mb-3 mx-auto" style="width: 100px; height: 100px; background: #f7fafc; display: flex; align-items: center; justify-content: center; border-radius: 50%;">
                        <i class="fa fa-folder-open fa-3x" style="color: #cbd5e0;"></i>
                    </div>
                    <h6 class="fw-bold text-muted">Sin movimientos registrados</h6>
                    <p class="text-muted small">Use el panel de la izquierda para ingresar una nueva tasa oficial.</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal: Confirmar Guardar Tasa -->
<ng-template #modalConfirmarGuardar let-modal>
    <div class="modal-content border-0 shadow-lg" style="border-radius: 16px; overflow: hidden;">
        <div class="modal-body p-5 text-center bg-white">
            
            <!-- Icono con Pulso Animado (Verde) -->
            <div class="icon-confirm-pulse green">
                <i class="fas fa-save"></i>
            </div>

            <h4 class="font-weight-bold text-dark mb-3">¿Registrar Tasa BCV?</h4>
            <p class="text-muted font-weight-500 mb-5" style="font-size: 1rem; line-height: 1.6;">
                ¿Está seguro que desea registrar la tasa de cambio para la fecha seleccionada? Esta acción actualizará los cálculos del sistema de forma inmediata.
            </p>

            <div class="d-flex justify-content-center align-items-center">
                <button type="button" class="btn btn-cancel btn-block mr-3 shadow-none p-3" 
                    (click)="modal.dismiss('No')" 
                    style="flex: 1;">
                    No, Cancelar
                </button>
                <button type="button" class="btn btn-ok btn-block m-0 shadow-none p-3" 
                    (click)="registrarTasa(modal)" 
                    style="flex: 1;">
                    Sí, Guardar
                </button>
            </div>
        </div>
    </div>
</ng-template>

<!-- Modal: Confirmar Eliminar Tasa -->
<ng-template #modalConfirmarEliminar let-modal>
    <div class="modal-content border-0 shadow-lg" style="border-radius: 16px; overflow: hidden;">
        <div class="modal-body p-5 text-center bg-white">
            
            <!-- Icono con Pulso Animado (Rojo) -->
            <div class="icon-confirm-pulse red">
                <i class="fas fa-trash-alt"></i>
            </div>

            <h4 class="font-weight-bold text-dark mb-3">¿Eliminar Registro?</h4>
            <p class="text-muted font-weight-500 mb-5" style="font-size: 1rem; line-height: 1.6;">
                ¿Está seguro que desea eliminar este registro histórico? Esta acción no se puede deshacer.
            </p>

            <div class="d-flex justify-content-center align-items-center">
                <button type="button" class="btn btn-cancel btn-block mr-3 shadow-none p-3" 
                    (click)="modal.dismiss('No')" 
                    style="flex: 1;">
                    No, Cancelar
                </button>
                <button type="button" class="btn btn-trash btn-block m-0 shadow-none p-3" 
                    (click)="eliminarTasa(modal)" 
                    style="flex: 1;">
                    Sí, Eliminar
                </button>
            </div>
        </div>
    </div>
</ng-template>